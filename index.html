<html>
<head>
    <title>LightPi Web</title>
    <meta name="viewport" content ="width=device-width,initial-scale=2,user-scalable=yes" />
    <LINK href="/css/button.css" rel="stylesheet" type="text/css">
    <LINK href="/css/ui-darkness/jquery-ui-1.10.3.custom.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/farbtastic/farbtastic.css" type="text/css" />
    <style>
        body {
            max-width: 200px;
        }

        .button {
            width: 100%;
        }

        .porch {
            width: 48%;
        }

        #color {
            width: 75px;
        }
    </style>
    
    <script src="/js/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="/farbtastic/farbtastic.js"></script>
    <!--<script src="/js/jquery-ui-1.10.3.custom.min.js"></script>-->

    <script src="/js/animations.js"></script>

    <script type="text/javascript">
        function apiSuccess(data) {
            console.log("Call success! - " + data);
        }
        function apiFail(data) {
            console.log("Call failed! - " - data);
        }

        //Where the magic happens
        function _sendJSON(obj) {
            json_str = JSON.stringify(obj);

            $.ajax({
                url: "/api/json",
                type: "POST",
                contentType: "application/json",
                data: json_str,
                success: apiSuccess,
            })
            .fail(apiFail);
        }

        function sendJSON(display, params) {
            var json = { display: display, params: params };
            _sendJSON(json);
        }
        
        function api_fill_color(fill) {
            if (fill != "") {
                sendJSON('fill_color', { color: fill });
            }
        }

        function fill_color_change() {
            fill_name = $('#fill_colors').val();

            api_fill_color(_colors[fill_name]);
        }

        function quickselect_change() {
            color = $('#quickselect').val();
            $.farbtastic('#colorpicker').setColor("#" + _colors[color]);
        }

        function patternChange() {
            id = $('#patterns').val();
            if (id != "") {
                sendJSON("pattern", _led_patterns[id]);
            }
        }

        function misc_animChange() {
            id = $('#misc_anim').val();
            if (id != "") {
                var anim = _misc_anim[id];
                
                if ("getColor" in anim && "color" in anim.params) {
                    anim.params.color = getFarbColor();
                }
                        
                _sendJSON(anim);
            }
        }

        function api_larson() {
            sendJSON('larson', { color: getFarbColor(), tail: 36, delay: 0 });
        }

        function api_larson_rainbow() {
            sendJSON('larson_rainbow', { tail: 36, delay: 0 });
        }

        function getFarbColor() {
            return $.farbtastic('#colorpicker').color;
        }

        function loadDropDown(id, dict) {
            var dd = $(id);
            $.each(dict, function (name, p) {
                dd.append(
                    $('<option></option>').val(name).html(name)
                );
            });
        }

        $(document).ready(function () {
            $('#colorpicker').farbtastic('#color');

            loadDropDown('#fill_colors', _colors);
            loadDropDown('#quickselect', _colors);
            loadDropDown('#patterns', _led_patterns);
            loadDropDown('#misc_anim', _misc_anim);

            $('#misc_anim').change(misc_animChange);

            $('#patterns').change(patternChange);
            $('#fill_colors').change(fill_color_change);
            $('#quickselect').change(quickselect_change);
            $('#allOff').click(function () {
                sendJSON('off', null);
            });
            $('#larson').click(api_larson);
            $('#larson_rainbow').click(api_larson_rainbow);

        });
    </script>
</head>
<body>
    <a class="button" id="allOff" href="#" style="width:100%">All Off</a>
    <br />
    <br />
    
    <a class="button porch" id="p100" href="#" onclick="api_fill_color('ffffffe6');">100%</a>
    <a class="button porch" id="p75" href="#" onclick="api_fill_color('ffffffC0');">75%</a>
    <br />
    <br />
    <a class="button porch" id="p50" href="#" onclick="api_fill_color('ffffff80');">50%</a>
    <a class="button porch" id="p25" href="#" onclick="api_fill_color('ffffff40');">25%</a>
    <br />
    <br />
    <div id="colorpicker"></div>
    <br />
    <form>
        <input type="text" id="color" name="color" value="#FF0000" />
        <select id="quickselect">
            <option value="">Quick Select</option>
        </select>
    </form>
    <br />
    <a class="button" id="larson" href="#">Larson Scanner</a>
    <br />
    <br />
    <a class="button" id="larson_rainbow" href="#">Larson Rainbow</a>
    <br />
    <br />
    <select id="misc_anim">
        <option value="">Select an Animation</option>
    </select>
    <br />
    <br />
    <select id="fill_colors">
        <option value="">Select a Color</option>
    </select>
    <br />
    <br />
    <select id="patterns">
        <option value="">Select a Pattern</option>
    </select>
</body>
</html>